############################
#
# Civilian Trade Events
#
# Written by Kyoj1n
#
############################

namespace = civtradetest

planet_event = {
	id = civtradetest.1
	hide_window = yes
	location = ROOT
	
	trigger = {
		owner = {is_country_type = default
		}
	}
	is_triggered_only = yes
	immediate = {
		set_variable = { 
			which = number_of_stops
			value = 3
		}
		random_country = {
			limit = {
				is_country_type = default
				}
				create_leader = {
					type = admiral
					name = random
					skill = 100
				}
		}				
		create_fleet = { name = "Civilian Trade Fleet" }
			
			last_created_fleet = {
				set_variable = { 
					which = number_of_stops
					value = 2
				}
				set_owner = root.owner
				set_fleet_stance = evasive
				save_event_target_as = trade_fleet
				set_fleet_flag = civilian_trade_fleet
				if = {
					random_list = { 
						50 = { create_ship_design = {
							design = "T1" 
						   ftl = root.owner
							}
						}
						50 = {  create_ship_design = {
							design = "T2" 
						   ftl = root.owner
							}
						}
					}
				}
				
				create_ship = {
					name = random
					design = last_created_design
					graphical_culture = "pirate_01"
				}
				
				assign_leader = last_created_leader
				set_location = ROOT
					queue_actions = {	
						repeat = {
							while = {
								id = "civtradertest.1.trigger.1"
								check_variable = {
									which = number_of_stops
									value > 0
								}
							}
							find_random_system = {
								trigger = {
									id = "civtradetest.1.trigger.2"
									distance = {
										source = PREV
										max_distance = 30
										min_distance = 0
									}	
								}		

								found_system = {
										move_to = THIS
									}
								}	
								find_random_planet = {
									trigger = {
										id = "civtradetest.1.trigger.3"
										is_star = yes
									}																	
									found_planet = {
										orbit_planet = THIS 
										wait = {
											duration = 10
										}
											
										effect = {
											id = civtradetest.1.effect.1
											event_target:trade_fleet = { fleet_event = { id = civtradetest.2 } }
										}
									}												
								}
							
						}
					}


			}					
			
				
	}
			
}

fleet_event = {
	id = civtradetest.2
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		this = {
			if = {
				limit = {
					check_variable = {
						which = "number_of_stops"
						value = 3
					}
				}
				set_variable = {
					which = "number_of_stops"
					value = 2
				}
				else = {
					if = {
						limit = {
							check_variable = {
								which = "number_of_stops"
								value = 2											
							}
						}
						set_variable = {
							which = "number_of_stops"
							value = 1
						}
						else = {
							set_variable = {
								which = "number_of_stops"
								value = 0															
							}
							delete_fleet = this
						}
						
					}
						
				}
			}	
		}
	}
	




}