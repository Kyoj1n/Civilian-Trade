############################
#
# Civilian Trade Events
#
# Written by Kyoj1n
#
############################

namespace = civtrade

planet_event = {
	id = civtrade.1
	hide_window = yes
	location = ROOT
	
	trigger = {
		owner = {is_country_type = default
		}
		has_planet_flag = trade_planet	

	}
	is_triggered_only = yes
	immediate = {
		if = {
			limit = {
				count_pops = {
					count > 5
				}
			}
			set_variable = { 
				which = population_size
				value = 1
			}
		}
	
		
		random_country = {
			limit = {
				is_country_type = default
				}
				create_leader = {
					type = admiral
					name = random
					skill = 100
				}
		}				
		create_fleet = { name = "Civilian Trade Fleet" }
			
			last_created_fleet = {
				if = {
					limit = {
						root = {
							has_planet_flag = small_population
						}	
					}
					set_variable = { 
						which = number_of_stops
						value = 1
					}				
				}
				if = {
					limit = {
						root = {
							has_planet_flag = large_population
						}
					}
					set_variable = { 
						which = number_of_stops
						value = 2
					}				
				}			
				if = {
					limit = {
						root = {
							has_planet_flag = large_population
						}
					}
					set_variable = { 
						which = number_of_stops
						value = 3
					}				
				}			
				set_owner = root.owner
				set_fleet_stance = evasive
				save_event_target_as = trade_fleet
				set_fleet_flag = civilian_trade_fleet
				if = {
					random_list = { 
						50 = { create_ship_design = {
							design = "T1" 
						   ftl = root.owner
							}
						}
						50 = { create_ship_design = {
							design = "T2" 
						   ftl = root.owner
							}
						}
					}
				}
				
				create_ship = {
					name = random
					design = last_created_design
					graphical_culture = "pirate_01"
				}
				
				assign_leader = last_created_leader
				set_location = ROOT
					queue_actions = {	
						repeat = {
							while = {
								id = "civtrade.1.trigger.1"
								check_variable = {
									which = number_of_stops
									value > 0
								}
							}
							find_random_system = {
								trigger = {
									id = "civtrade.1.trigger.2"
									distance = {
										source = PREV
										max_distance = 30
										min_distance = 0
									}	
								}		

								found_system = {
										move_to = THIS
									}
								}	
								find_random_planet = {
									trigger = {
										id = "civtrade.1.trigger.3"
										is_star = yes
									}																	
									found_planet = {
										orbit_planet = THIS 
										wait = {
											duration = 10
										}
											
										effect = {
											id = civtrade.1.effect.1
											event_target:trade_fleet = { fleet_event = { id = civtrade.2 } }
										}
									}												
								}
							
						}
					}


			}					
			
				
	}
			
}

fleet_event = {
	id = civtrade.2
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		this = {
			if = {
				limit = {
					check_variable = {
						which = "number_of_stops"
						value = 3
					}
				}
				set_variable = {
					which = "number_of_stops"
					value = 2
				}
				else = {
					if = {
						limit = {
							check_variable = {
								which = "number_of_stops"
								value = 2											
							}
						}
						set_variable = {
							which = "number_of_stops"
							value = 1
						}
						else = {
							set_variable = {
								which = "number_of_stops"
								value = 0															
							}
							delete_fleet = this
						}
						
					}
						
				}
			}	
		}
	}
}
# need to change these to look for trader factions and base the flags off of number of trader pops (?)
planet_event = {
	id = civtrade.3
	hide_window = yes
	location = ROOT
	
	trigger = {
		count_pops = {
			count > 5
		}
		count_pops = {
					count < 12
				}
	}
	
	immediate = {
		if = {
			limit = {
				count_pops = {
					count < 12
				}
			}
			set_planet_flag = small_population		
		}

		if = {
			limit = {
					count_pops = {
						count > 12
					}				
			}
			remove_planet_flag = small_population
			set_planet_flag = medium_population
		}
		
		if = {
			limit = {
				count_pops = {
					count > 17
				}
			}
			remove_planet_flag = small_population
			remove_planet_flag = medium_population
			set_planet_flag = large_population										
		}					
	}
}

planet_event = {
	id = civtrade.4
	hide_window = yes
	location = ROOT
	
	trigger = {
		any_pop = {
			member_of_faction = yes
			pop_faction = {
				is_pop_faction_type = prosperity
			}
		}
	}
	
	immediate = {
		root = {
			set_planet_flag = trade_planet
		}
	}
}

country_event = {
	id = civtrade.5
	hide_window = yes
	location = ROOT
	
	trigger = {
	}
	
	mean_time_to_happen = {
		 days = 30
	}
	
	immediate = {
		random_country = {
			random_planet = {
				limit = {
					has_planet_flag = trade_planet
				}
				planet_event = { id = civtrade.1 days = 15 random 5 }
			}
		}
	}
}

